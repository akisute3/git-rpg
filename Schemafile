# -*- mode: ruby -*-

create_table :users do |t|
  ## Database authenticatable
  t.string :username,           null: false, default: ""
  t.string :email,              null: false, default: ""
  t.string :encrypted_password, null: false, default: ""

  ## Recoverable
  t.string   :reset_password_token
  t.datetime :reset_password_sent_at

  ## Rememberable
  t.datetime :remember_created_at

  ## Trackable
  t.integer  :sign_in_count, default: 0, null: false
  t.datetime :current_sign_in_at
  t.datetime :last_sign_in_at
  t.string   :current_sign_in_ip
  t.string   :last_sign_in_ip

  t.timestamps null: false
end

add_index :users, :username,             unique: true
add_index :users, :email,                unique: true
add_index :users, :reset_password_token, unique: true


create_table :user_statistics do |t|
  t.integer :user_id
  t.integer :level, default: 1
  t.integer :exp, default: 0
  t.timestamps null: false
end


create_table :mst_level_up_exps do |t|
  t.integer :level
  t.integer :exp
  t.timestamps null: false
end


create_table :authors do |t|
  t.integer :user_id
  t.string  :name
  t.string  :email
  t.timestamps null: false
end


create_table :mst_git_services do |t|
  t.string :name
end


create_table :mst_commit_operations do |t|
  t.string :name
end


create_table :repositories do |t|
  t.integer :mst_git_service_id
  t.string  :name
  t.string  :homepage
  t.integer :project_id
  t.timestamps null: false
end


create_table :pushes do |t|
  t.integer :repository_id
  t.timestamps null: false
end


create_table :commits do |t|
  t.integer  :author_id
  t.integer  :push_id
  t.string   :commit_hash
  t.text     :message
  t.datetime :timestamp
  t.string   :url
  t.timestamps null: false
end


create_table :commit_files do |t|
  t.integer :commit_id
  t.string  :path
  t.integer :mst_commit_operation_id
  t.timestamps null: false
end
